#!/usr/bin/env php
<?php
/**
 * This file is part of Tables4DMs project.
 *
 * @author Maykel S. Braz <maykelsb@yahoo.com.br>
 * @license https://opensource.org/licenses/MIT The MIT License
 * @copyright 2017 Maykel S. Braz
 * @link http://github.com/maykelsb/tables4dms-api
 */

require_once __DIR__ . '/../app/bootstrap.php';

$console = new Lokhman\Silex\Console\Console($app);

$app->register(
    new Kurl\Silex\Provider\DoctrineMigrationsProvider($console),
    $app['config']['migrations']
);

// -- Loading doctrine commands
$helperSet = $console->getHelperSet();
$helperSet->set(
    new Doctrine\DBAL\Tools\Console\Helper\ConnectionHelper(
        $app['orm.em']->getConnection()
    ),
    'db'
);
$helperSet->set(
    new Doctrine\ORM\Tools\Console\Helper\EntityManagerHelper($app['orm.em']),
    'em'
);

// -- Fix to Doctrine annotations find Swagger namespace
Doctrine\Common\Annotations\AnnotationRegistry::registerLoader([
    $loader,
    'loadClass'
]);

$console->setHelperSet($helperSet);
Doctrine\ORM\Tools\Console\ConsoleRunner::addCommands($console);

// -- Dump routes command
$utilCommand = new Tables4dms\Command\UtilCommand();
//$utilCommand->setApp(new Silex\Application());
$console->add($utilCommand);

$app->boot();
$console->run();

